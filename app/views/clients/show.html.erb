<div class="p-6 space-y-10">
  <h2 class="text-3xl font-bold">üßæ Fiche client</h2>

  <!-- Carte D√©tails du client -->
  <div class="bg-white rounded-2xl shadow p-6 border border-gray-200 space-y-2">
    <h3 class="text-xl font-semibold text-gray-700 mb-4">üë§ Informations g√©n√©rales</h3>
    <p><span class="font-medium">Nom :</span> <%= @client.nom %></p>
    <p><span class="font-medium">Pr√©nom :</span> <%= @client.prenom %></p>
    <p><span class="font-medium">Email :</span> <%= @client.email.presence || "‚Äî" %></p>
    <p><span class="font-medium">T√©l√©phone :</span> <%= @client.telephone.presence || "‚Äî" %></p>
    <p><span class="font-medium">Ancien ID :</span> <%= @client.ancien_id %></p>

    <div class="mt-4">
      <%= link_to "‚úèÔ∏è Modifier", edit_client_path(@client),
        class: "inline-block px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600" %>
    </div>
  </div>
  <br>
  <% if @client.deposant? %>
    <!-- PDF -->
    <div>
      <%= link_to "üìÑ G√©n√©rer le PDF pour la d√©posante", generate_pdf_client_path(@client), target: "_blank",
        class: "inline-block px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-800" %>
    </div>
  <br>
    <!-- Produits d√©pos√©s -->
    <div class="space-y-4">
      <h3 class="text-2xl font-semibold">üëú Produits d√©pos√©s</h3>
      <% produits_deposes = @client.produits.where(en_depot: true) %>
      <% if produits_deposes.any? %>
        <div class="overflow-x-auto rounded-lg shadow border border-gray-200">
          <table class="min-w-full table-auto text-sm">
            <thead class="bg-gray-100">
              <tr>
                <th class="px-4 py-3 text-left">Nom</th>
                <th class="px-4 py-3 text-left">Cat√©gorie</th>
                <th class="px-4 py-3 text-left">Stock</th>
                <th class="px-4 py-3 text-right">Prix demand√©</th>
                <th class="px-4 py-3 text-left">Statut</th>
                <th class="px-4 py-3 text-left">Date de d√©p√¥t</th>
                <th class="px-4 py-3 text-left">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% produits_deposes.each do |produit| %>
                <tr class="border-t hover:bg-gray-50">
                  <td class="px-4 py-2"><%= link_to produit.nom, produit_path(produit), class: "text-blue-600 hover:underline" %></td>
                  <td class="px-4 py-2"><%= produit.categorie %></td>
                  <td class="px-4 py-2"><%= produit.stock %></td>
                  <td class="px-4 py-2 text-right"><%= number_to_currency(produit.prix_deposant) %></td>
                  <td class="px-4 py-2"><%= produit.ventes.any? ? "‚úîÔ∏è Vendu" : "‚ùå Non vendu" %></td>
                  <td class="px-4 py-2"><%= produit.date_depot&.strftime("%d/%m/%Y") %></td>
                  <td class="px-4 py-2">
                    <%= link_to "Modifier", edit_produit_path(produit), class: "text-yellow-600 hover:underline" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <p class="italic text-green-700">‚úÖ Aucun produit d√©pos√©.</p>
      <% end %>
    </div>
  <br>
    <!-- Versements effectu√©s -->
    <% if @client.versements.any? %>
      <h2 class="text-xl font-bold mt-6 mb-2">üí≥ Versements effectu√©s</h2>
      <% @client.versements.order(created_at: :desc).each do |versement| %>
        <div class="mb-6 border rounded shadow p-4">
          <h3 class="font-semibold text-gray-700 mb-2">Re√ßu n¬∞<%= versement.numero_recu %> ‚Äî <%= l(versement.created_at, format: :short) %></h3>
          <table class="table-auto w-full border">
            <thead>
              <tr class="bg-green-100">
                <th class="px-4 py-2">Produit</th>
                <th class="px-4 py-2">Vente</th>
                <th class="px-4 py-2 text-center">Quantit√©</th>
                <th class="px-4 py-2 text-right">Montant</th>
              </tr>
            </thead>
            <tbody>
              <% versement.produits_versements.each do |pv| %>
                <% next unless pv.produit.client == @client %>
                <tr>
                  <td class="border px-4 py-2"><%= pv.produit.nom %></td>
                  <td class="border px-4 py-2">#<%= pv.vente_id %></td>
                  <td class="border px-4 py-2 text-center"><%= pv.quantite %></td>
                  <td class="border px-4 py-2 text-right"><%= number_to_currency(pv.produit.prix_deposant * pv.quantite) %></td>
                </tr>
              <% end %>
              <tr class="font-bold">
                <td colspan="3" class="border px-4 py-2 text-right">Total</td>
                <td class="border px-4 py-2 text-right"><%= number_to_currency(versement.montant) %></td>
              </tr>
            </tbody>
          </table>
        </div>
      <% end %>
    <% else %>
      <p class="italic text-green-700">‚úÖ Aucun versement effectu√© pour cette d√©posante.</p>
    <% end %>
  <% end %>
  <br>
  <h3 class="text-2xl font-semibold">üíº Paiements en attente</h3>
  <!-- Paiements en attente (partiel) -->
  <turbo-frame id="paiements_en_attente">
    <%= render partial: 'paiements/paiements_en_attente', locals: { paiements_en_attente: @paiements_en_attente } %>
  </turbo-frame>
</div>
