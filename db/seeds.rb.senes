# R√©cup√©rer le fournisseur existant
senes = Fournisseur.find_by(nom: "Senes")

unless senes
  puts "‚ùå Le fournisseur 'Senes' n'existe pas dans la base. Ajoutez-le d'abord."
  exit
end

begin
  date = Date.parse("2025-03-14")
rescue ArgumentError
  date = nil
end

# Liste compl√®te des produits √† ajouter
produits = [
  { code_fournisseur: "538", nom: "Robe", prix_achat: 15, stock: 6 },
  { code_fournisseur: "2978", nom: "Robe", prix_achat: 11, stock: 8 },
  { code_fournisseur: "550", nom: "Top", prix_achat: 10, stock: 12 },
  { code_fournisseur: "898", nom: "Robe", prix_achat: 16.50, stock: 6 }
]

produits.each do |prod|
  # V√©rifier si le produit existe d√©j√† avec le m√™me `code_fournisseur`
  existing_product = Produit.find_by(code_fournisseur: prod[:code_fournisseur])

  if existing_product
    puts "‚ö†Ô∏è Produit '#{prod[:nom]}' (Code: #{prod[:code_fournisseur]}) existe d√©j√†, il ne sera pas ajout√©."
  else
    produit = Produit.new(
      code_fournisseur: prod[:code_fournisseur],
      nom: prod[:nom],
      prix_achat: prod[:prix_achat],
      stock: prod[:stock],
      fournisseur: senes,
      etat: "neuf",
      categorie: "v√™tement",
      impression_code_barre: true, # Ajout de la valeur par d√©faut
      date_achat: date
    )

    if produit.valid?
      produit.save!
      puts "‚úÖ Produit '#{produit.nom}' ajout√© avec succ√®s."
    else
      puts "‚ùå ERREUR: Impossible d'ajouter '#{produit.nom}'"
      puts "Probl√®mes d√©tect√©s :"
      puts produit.errors.full_messages.join("\n")
    end
  end
end

puts "üéâ Seed termin√© !"
